<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Kelly Chang,rasca0027@gmail.com"><title>AWS Lambda Tutorial - how to create a daily scheduled task · Azimuth</title><meta name="description" content="In this tutorial, I’m going to talk about how to create a AWS Lambda function triggered by scheduled events.For example, I want to schedule a daily jo"><meta name="keywords" content="Hexo,LeetCode,Linux,GameDesign,GameDev"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">Azimuth</a></h3><div class="description"><p>Dev Diaries</p></div></div></div><ul class="social-links"><li><a href="https://twitter.com/rasca0027"><i class="fa fa-twitter"></i></a></li><li><a href="http://instagram.com/rasca0027"><i class="fa fa-instagram"></i></a></li><li><a href="http://github.com/rasca0027"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>AWS Lambda Tutorial - how to create a daily scheduled task</a></h3></div><div class="post-content"><p>In this tutorial, I’m going to talk about how to create a AWS Lambda function triggered by scheduled events.<br>For example, I want to schedule a daily job of pulling data from an API and save the data to a s3 bucket. First I need to create a lambda function, and choose “CloudWatch Events” from the trigger list.  </p>
<p><img src="/images/lambda1.png" alt=""></p>
<p>Then click on the center function itself and scroll down to see the file editor. You can choose to upload a zip file that contains your code, but for simple functions you can also just edit the code inline.  </p>
<p>Choose whatever runtime you want. In my case, I’m using Python 3.7.  </p>
<p><img src="/images/lambda2.png" alt=""></p>
<p>You can change the name of the function from <code>lambda_handler</code> to whatever you like, but make sure to change the name shown in “Handler” too.  </p>
<p>You can start writing your function too as you like. For example, I have the following code to download a gz file from url and decompress, and finally save to s3 bucket.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">from io import BytesIO</span><br><span class="line">import gzip</span><br><span class="line">from datetime import datetime</span><br><span class="line"></span><br><span class="line">from botocore.vendored import requests</span><br><span class="line">import boto3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_export(event, context):</span><br><span class="line">    </span><br><span class="line">    # get file</span><br><span class="line">    r = requests.get(fileurl)</span><br><span class="line">    fileobj = BytesIO(r.content)</span><br><span class="line">    f = gzip.GzipFile(mode=&quot;rb&quot;, fileobj=fileobj)</span><br><span class="line">    data = f.read()</span><br><span class="line">    </span><br><span class="line">    # upload to s3</span><br><span class="line">    s3 = boto3.resource(&quot;s3&quot;)</span><br><span class="line">    bucket_name = &quot;unity-analytics-library&quot;</span><br><span class="line">    today = datetime.now().strftime(&quot;%Y-%m-%d&quot;)</span><br><span class="line">    s3_path = &quot;unity-export-&#123;0&#125;.tsv&quot;.format(today)</span><br><span class="line">    s3.Bucket(bucket_name).put_object(Key=s3_path, Body=data)</span><br><span class="line">    </span><br><span class="line">    return &#123;</span><br><span class="line">        &apos;statusCode&apos;: 200,</span><br><span class="line">        &apos;s3_file&apos;: s3_path</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>Just a few things to note here:  </p>
<ul>
<li><p>If you want to use <code>requests</code>, you can use <code>from botocore.vendored import requests</code> instead</p>
</li>
<li><p>AWS Lambda does not support opening and saving files since it doesn’t have a filesystem. Therefore if you are doing some fileobject manipulation like me, you can use <code>BytesIO</code> or <code>StringIO</code> instead.  </p>
</li>
<li><p>If you are using other AWS resources, for example s3 like me in the example, you don’t have to authenticate in your code since they are both AWS resources. However you do need to make sure the IAM role you’re using for this Lambda function has sufficient permission to do whatever you need. For example in my case I had to make a bucket policy to grant write permission to this particular IAM role.  </p>
</li>
</ul>
<p>The bucket policy would look like something like this:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Sid&quot;: &quot;AllowS3Access&quot;,</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Principal&quot;: &#123;</span><br><span class="line">                &quot;AWS&quot;: &quot;arn:aws:iam::&lt;your-iam-role&gt;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Action&quot;: &quot;s3:*&quot;,</span><br><span class="line">            &quot;Resource&quot;: [</span><br><span class="line">                &quot;arn:aws:s3:::&lt;bucket-name&gt;&quot;,</span><br><span class="line">                &quot;arn:aws:s3:::&lt;bucket-name&gt;/*&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-02-15</span><i class="fa fa-tag"></i><a class="tag" href="/tags/AWS-lambda-python-tutorial/" title="AWS, lambda, python, tutorial">AWS, lambda, python, tutorial </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,http://rasca0027.github.io/2019/02/15/AWS-Lambda-Tutorial-how-to-create-a-daily-scheduled-task/,Azimuth,AWS Lambda Tutorial - how to create a daily scheduled task,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/2019/01/14/Using-Async-Task-Queue-Celery-with-Django/" title="Using Async Task Queue Celery with Django">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>